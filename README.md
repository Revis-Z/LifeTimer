# LifeTimer - 励志闹钟应用

## 项目概述
LifeTimer是一款专注于励志语音唤醒的iOS闹钟应用。通过高质量的励志语音内容替代传统闹铃声，为用户提供积极正面的起床体验，帮助用户以更好的心态开始每一天。应用采用极简设计理念，专注于核心功能，为有自我提升需求的用户群体提供情感价值和动力激发。

## 目标用户
- **主要用户群体**: 18-35岁的职场人士和学生群体
- **用户特征**: 有自我提升意识、追求积极生活态度、对传统闹铃声感到厌倦
- **使用场景**: 工作日早晨唤醒、重要日程前的激励、养成良好作息习惯

## 技术选型
- **开发框架**: SwiftUI (主要) + UIKit (必要时补充)
- **数据持久化**: Core Data
- **状态管理**: SwiftUI原生状态管理 (@State, @StateObject, @EnvironmentObject)
- **音频播放**: AVFoundation
- **本地通知**: UserNotifications
- **UI风格**: 遵循iOS Human Interface Guidelines (HIG)，采用暗色科技风现代简约设计

## 应用结构
```
LifeTimer App
├── 闹钟设置模块
│   ├── 时间设置
│   ├── 重复模式
│   ├── 音量调节
│   └── 闹钟管理
├── 励志语音模块
│   ├── 语音内容库 (10条内置语音)
│   ├── 随机播放
│   └── 语音播放器
└── 应用设置模块
    ├── 通知权限
    ├── 应用偏好
    └── 关于页面
```

## 页面结构

| 页面/视图名称 | 用途 | 核心功能 | 技术实现 | 导航/用户流程 | 建议文件路径 |
|:--------:|:----:|:--------:|:--------:|:--------:|:--------:|
| 主页面(闹钟列表) | 显示所有闹钟的主界面 | 闹钟列表展示、快速开关、添加新闹钟 | SwiftUI + List + NavigationView | 应用启动默认页面，可导航到设置页面和闹钟编辑页面 | `LifeTimer/MainView.swift` |
| 闹钟设置页面 | 创建和编辑闹钟 | 时间选择、重复模式设置、音量调节、保存/删除闹钟 | SwiftUI + DatePicker + Slider | 从主页面Push进入，完成后返回主页面 | `LifeTimer/AlarmSettingView.swift` |
| 闹钟响起页面 | 闹钟触发时的全屏界面 | 显示当前时间、播放励志语音、关闭闹钟、播放控制 | SwiftUI + AVAudioPlayer + 全屏Modal | 系统通知触发，全屏Modal展示，关闭后返回主页面 | `LifeTimer/AlarmRingingView.swift` |
| 应用设置页面 | 管理应用配置和权限 | 通知权限管理、应用偏好设置、关于信息、意见反馈 | SwiftUI + Settings + UserNotifications | 从主页面导航进入，可返回主页面 | `LifeTimer/SettingsView.swift` |

| 语音内容管理 | 管理励志语音内容 | 语音列表展示、试听功能、语音信息查看 | SwiftUI + AVAudioPlayer + List | 从设置页面进入，可返回设置页面 | `LifeTimer/VoiceContentView.swift` |

## 数据模型
### 核心实体
- **Alarm**: 闹钟实体 (时间、重复模式、音量、启用状态)
- **VoiceContent**: 语音内容实体 (标题、文件路径、时长、描述)
- **AppSettings**: 应用设置实体 (通知权限、用户偏好)


### 数据关系
- 一个用户可以有多个闹钟
- 每个闹钟可以关联多个语音内容


## 技术实现细节

### 主页面(闹钟列表)

#### UI设计方案
- 使用NavigationView + List布局，提供清晰的层级结构
- 采用暗色科技风主题，使用冷色系渐变背景
- 闹钟卡片采用毛玻璃效果，增强视觉层次
- 浮动添加按钮使用渐变色和阴影效果
- 空状态视图提供友好的引导信息

#### 数据管理方案
- 使用@StateObject管理AlarmStore实例
- 通过Core Data进行本地数据持久化
- 实现响应式数据更新和状态同步


#### 交互实现
- 自定义Toggle开关，带有流畅动画效果
- 支持滑动删除和长按菜单操作
- 触觉反馈增强用户体验
- 响应式布局适配不同设备尺寸

#### iOS特性利用
- 集成UserNotifications进行本地通知管理
- 使用SF Symbols提供一致的图标体验
- 支持Dynamic Type和暗色模式
- 利用SwiftUI的声明式UI优势

#### 可访问性考虑
- 完整的VoiceOver支持，包括有意义的accessibility labels
- 支持Dynamic Type字体缩放
- 高对比度模式适配
- 符合WCAG标准的颜色对比度

#### 组件复用
- 创建可重用的闹钟卡片组件
- 统一的按钮和开关样式
- 共享的颜色和字体主题

### 闹钟设置页面

#### UI设计方案
- 使用NavigationView + Form布局，提供原生iOS设置体验
- 时间选择器使用DatePicker的轮盘模式，符合iOS用户习惯
- 重复模式采用分段控制器 + 自定义选择器组合
- 暗色科技风主题，使用毛玻璃效果和渐变背景
- 音量控制使用自定义滑块，带有实时预览功能

#### 数据管理方案
- 使用@State管理临时编辑状态
- 使用@EnvironmentObject获取AlarmStore实例
- 实现数据验证和错误处理机制
- 支持新建和编辑两种模式的状态管理

#### 交互实现
- 流畅的页面转场动画和状态切换
- 实时的音量预览和触觉反馈
- 智能的重复模式选择交互
- 保存前的数据验证和用户确认

#### iOS特性利用
- 使用DatePicker的原生时间选择体验
- 集成AVAudioPlayer进行音量预览
- 使用UIImpactFeedbackGenerator提供触觉反馈
- 支持Dynamic Type和暗色模式

#### 可访问性考虑
- 完整的VoiceOver支持和语义化标签
- 支持Dynamic Type字体缩放
- 高对比度模式适配
- 键盘导航和焦点管理

#### 组件复用
- 复用主页面的设计语言和色彩方案
- 使用统一的按钮和卡片样式
- 集成现有的Alarm数据模型

### 闹钟响起页面

#### UI设计方案
- 使用全屏Modal展示，确保用户注意力集中在闹钟上
- 大字体显示当前时间，使用动态字体支持可访问性
- 励志语音标题和播放控制区域，提供清晰的音频反馈
- 暗色科技风背景，使用渐变和毛玻璃效果增强视觉层次
- 关闭闹钟的主要操作按钮，使用醒目的颜色引导用户
- 稍后提醒（贪睡）功能的次要按钮，提供灵活的使用选择

#### 数据管理方案
- 使用@State管理音频播放状态、当前时间和UI状态
- 使用@EnvironmentObject获取AlarmStore实例进行数据操作
- 集成AVAudioPlayer进行励志语音播放和音频控制
- 实现Timer定时器更新当前时间显示和播放进度

#### 交互实现
- 音频播放控制（播放/暂停/重播/音量调节）
- 关闭闹钟操作（更新闹钟状态并关闭页面）
- 贪睡功能（延迟5分钟重新触发通知）
- 音量控制和播放进度的实时显示

#### iOS特性利用
- 使用AVAudioPlayer进行高质量音频播放和控制
- Timer实现实时时间更新和播放进度跟踪
- UIImpactFeedbackGenerator提供操作触觉反馈
- 支持Dynamic Type和暗色模式的系统适配
- 防止屏幕自动锁定，确保闹钟持续显示

#### 可访问性考虑
- 完整的VoiceOver支持，包括播放状态和时间播报
- 支持Dynamic Type字体缩放，适应不同用户需求
- 高对比度模式适配，确保视觉清晰度
- 大按钮设计便于操作，降低误触概率

#### 组件复用
- 复用应用的暗色科技风设计语言和色彩方案
- 使用统一的按钮和卡片样式，保持设计一致性
- 集成现有的Alarm数据模型和AlarmStore管理逻辑

#### 功能完整性检查表（闹钟响起页面）
- [x] 全屏Modal展示界面
- [x] 大字体当前时间显示
- [x] 励志语音标题和描述展示
- [x] 音频播放控制（播放/暂停/重播）
- [x] 播放进度条和时间显示
- [x] 音量控制滑块
- [x] 关闭闹钟主要操作
- [x] 稍后提醒（贪睡）功能
- [x] 暗色科技风UI设计
- [x] 毛玻璃效果和视觉反馈
- [x] 触觉反馈集成
- [x] 防止屏幕自动锁定
- [x] 可访问性支持（VoiceOver、Dynamic Type）
- [x] 定时器管理和资源清理

#### 功能完整性检查表（主页面）
- [x] NavigationView + List布局结构
- [x] 顶部导航栏（标题和设置按钮）
- [x] 闹钟列表展示和卡片设计
- [x] 浮动添加按钮
- [x] 暗色科技风主题设计
- [x] AlarmStore数据模型管理
- [x] 响应式状态管理
- [x] 闹钟开关切换（带触觉反馈）
- [x] 交互动画效果
- [x] UserNotifications集成
- [x] VoiceOver可访问性支持
- [x] 空状态友好提示


#### 功能完整性检查表（闹钟设置页面）
- [x] 闹钟时间选择（DatePicker）
- [x] 重复模式选择（分段控制器）
- [x] 自定义重复日期选择
- [x] 音量控制（自定义滑块）
- [x] 闹钟启用状态切换
- [x] 保存/取消操作
- [x] 新建/编辑模式支持
- [x] 数据验证和错误处理
- [x] 暗色科技风UI设计
- [x] 毛玻璃效果和视觉反馈
- [x] 可访问性支持（VoiceOver、Dynamic Type）
- [x] 触觉反馈集成

### 应用设置页面

#### UI设计方案
- 使用NavigationView + Form布局，提供原生iOS设置体验
- 分组设置项，包括通知权限、应用偏好、关于信息等
- 暗色科技风主题，使用毛玻璃效果和渐变背景
- 设置项使用原生iOS控件（Toggle、Button、NavigationLink）
- 版本信息和开发者信息展示区域

#### 数据管理方案
- 使用@State管理UI状态和用户交互
- 使用@EnvironmentObject获取AlarmStore实例
- 集成UserNotifications检查和管理通知权限
- 使用UserDefaults存储应用偏好设置

#### 交互实现
- 通知权限检查和引导用户开启
- 应用偏好设置的实时保存
- 意见反馈和评分引导
- 关于页面的信息展示

#### iOS特性利用
- 使用UNUserNotificationCenter管理通知权限
- 集成StoreKit进行应用评分
- 使用MessageUI进行邮件反馈（可选）
- 支持Dynamic Type和暗色模式

#### 可访问性考虑
- 完整的VoiceOver支持和语义化标签
- 支持Dynamic Type字体缩放
- 高对比度模式适配
- 清晰的设置项描述和状态反馈

#### 组件复用
- 复用应用的暗色科技风设计语言
- 使用统一的按钮和卡片样式
- 集成现有的数据模型和状态管理

#### 功能完整性检查表
- [x] 通知权限管理和状态显示
- [x] 应用偏好设置（触觉反馈、声音预览、防锁屏、时间格式）
- [x] 内容管理入口（语音内容）
- [x] 反馈与支持功能（评分、反馈、关于页面）
- [x] 版本信息显示
- [x] 完整的可访问性支持
- [x] 系统设置跳转功能



### 语音内容管理页面

#### UI设计方案
- 采用NavigationView + List布局，展示所有可用的励志语音内容
- 使用分组列表显示不同类别的语音内容（晨起励志、工作激励、生活感悟等）
- 每个语音条目显示标题、时长、播放次数和收藏状态
- 支持搜索功能，用户可以快速找到特定的语音内容
- 提供播放预览功能，点击即可试听语音内容
- 整体采用暗色科技风格，主色调为青色，配合渐变背景

#### 数据管理方案
- 使用@EnvironmentObject获取AlarmStore中的语音内容数据
- 利用@State管理搜索文本、播放状态、选中的语音内容
- 使用@State控制不同分类的展开/折叠状态
- 通过AVAudioPlayer管理语音内容的播放和暂停
- 实现语音内容的收藏功能，数据持久化到UserDefaults

#### 交互实现
- 顶部搜索栏，支持实时搜索语音内容
- 语音条目支持点击播放/暂停，长按显示更多操作
- 收藏按钮支持添加/移除收藏，带有动画效果
- 分类标题支持点击展开/折叠该分类下的内容
- 播放进度条显示当前播放进度，支持拖拽调节
- 下拉刷新功能，重新加载语音内容列表

#### iOS特性利用
- 使用AVAudioPlayer进行音频播放和控制
- 利用AVAudioSession配置音频会话，确保播放质量
- 使用Core Data或UserDefaults存储用户的收藏偏好
- 支持Dynamic Type，确保文字大小适配用户偏好
- 利用VoiceOver提供完整的可访问性支持

#### 可访问性考虑
- 为所有语音条目提供详细的VoiceOver描述
- 播放控制按钮提供清晰的语音反馈
- 搜索功能支持VoiceOver导航和语音输入
- 确保颜色对比度符合WCAG标准
- 为播放进度提供语音描述和手势控制

#### 组件复用
- 复用AlarmStore中的语音内容数据模型
- 使用共享的渐变背景和列表样式组件
- 复用通用的导航栏样式和搜索组件
- 利用已有的颜色主题和字体样式
- 共享音频播放控制的UI组件

#### 功能完整性检查表
- [x] 语音内容分类列表展示
- [x] 搜索功能实现
- [x] 语音播放和暂停控制
- [x] 播放进度条和时长显示
- [x] 收藏功能和状态管理
- [x] 分类展开/折叠功能
- [x] 播放历史记录
- [x] 下拉刷新机制
- [x] 完整的可访问性支持

## 开发状态跟踪
| 页面/组件名称 | 开发状态 | 文件路径 |
|:-------------:|:--------:|:------------:|
| 主页面(闹钟列表) | ✅ 已完成 | `LifeTimer/MainView.swift` |
| 闹钟设置页面 | ✅ 已完成 | `LifeTimer/AlarmSettingView.swift` |
| 闹钟响起页面 | ✅ 已完成 | `LifeTimer/AlarmRingingView.swift` |
| 应用设置页面 | ✅ 已完成 | `LifeTimer/SettingsView.swift` |
| 语音内容管理页面 | ✅ 已完成 | `LifeTimer/VoiceContentView.swift` |

## 最近修复
- **2024/12/19**: 修复了 `RepeatMode` 枚举缺少 `Equatable` 协议导致的编译错误
  - 问题：`Binary operator '!=' cannot be applied to two 'RepeatMode' operands`
  - 解决：为 `RepeatMode` 枚举添加 `Equatable` 协议
  - 影响文件：`LifeTimer/Models/Alarm.swift`

## MVP版本特性 (v1.1)
- ✅ 移除用户管理模块和订阅管理模块
- ✅ 所有语音内容免费提供
- ✅ 专注于核心闹钟和励志语音功能
- ✅ 简化的应用设置功能
- ✅ 遵循iOS HIG的暗色科技风设计

## 未来功能储备
- 用户订阅管理和付费内容
- 更多励志语音内容包
- 用户自定义语音上传
- 智能唤醒(根据睡眠周期)
- 社交分享功能
- Apple Watch支持
- 多语言支持


---
**项目状态**: 页面规划完成，准备开始开发
**最后更新**: 2024年12月
**相关文档**: docs/PRD.md, docs/Roadmap.md, docs/Metrics_Framework.md